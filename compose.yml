name: myenv
services:
  editor:
    image: apiv1/myvim
    network_mode: ${NETWORK_MODE:-default}
    working_dir: ${PATH_PREFIX:-}${PWD}
    volumes:
      - home:/root
      - .:${PATH_PREFIX:-}${PWD}
      - ${DOCKER_SOCK:-/var/run/docker.sock}:/var/run/docker.sock
    tmpfs:
      - /root/.ssh
    configs:
      - source: .bash_aliases
        target: /root/.bash_aliases
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - LC_ALL=C.UTF-8
      - LANG=C.UTF-8
      - TZ=Asia/Shanghai
configs:
  .bash_aliases:
    content: |
      envrc_install() {
        mkdir -p ~/.envrc.d
        wget -qO ~/.envrc.d/.envrc https://apiv1.github.io/Shell/envrc
        load_envs
      }
      load_envs() {
        local ENV_PATH=~/.envrc.d
        for item in $$(ls -A $${ENV_PATH} 2>/dev/null)
        do
          . "$$ENV_PATH/$$item"
        done
      }
      load_envs
volumes:
  home:

version: '3.9'
services:
  xray:
    image: teddysun/xray
    command: xray run -c /etc/xray/config.json
    volumes:
      - ./config.client.json:/etc/xray/config.json
    ports:
      - 127.0.0.1:1080:1080
      - 127.0.0.1:3128:3128
  # docker内网络全局代理.
  # 开启代理, 默认服务运行后自己启动, 也可关闭后手动启动:
  # docker-compose exec redsocks redsocks-fw.sh start
  # 停止代理, 退出需手动执行, 否则网络异常:
  # docker-compose exec redsocks redsocks-fw.sh stop
  redsocks:
    image: apiv1/redsocks
    command: localhost 1080
    network_mode: host
    privileged: true
    environment:
      START_FW: 1
    depends_on:
      - xray
name: dood-sshd
services:
  dood:
    build:
      dockerfile_inline: |
        FROM linuxserver/openssh-server
        COPY --from=apiv1/docker /usr/local/bin/docker /usr/local/bin/docker
    command: |
      sudo sh -c '
        chown docker:docker /var/run/docker.sock
        sleep infinity
      '
    ports:
      - "2222:2222"
    environment:
      - LISTEN_PORT=2222
      - SUDO_ACCESS=true
      - USER_NAME=docker
      - PUBLIC_KEY_DIR=/public/.ssh
    volumes:
      - ${DOCKER_SOCK:-/var/run/docker.sock}:/var/run/docker.sock:rw
      - ssh:/public/.ssh/
      - logs:/config/logs
    restart: always
volumes:
  ssh:
  logs: